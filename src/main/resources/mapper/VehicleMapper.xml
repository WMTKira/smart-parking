<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.wmt.smartparking.mapper.VehicleMapper">

    <insert id="insertVehicle" parameterType="com.wmt.smartparking.dto.VehicleDto">
        INSERT INTO vehicle (plate_id,
                             owner_name,
                             car_type,
                             created_by,
                             updated_by)
        VALUES (#{plateId},
                #{ownerName},
                #{carType},
                'system',
                'system')
    </insert>

    <update id="updateVehicle">
        UPDATE vehicle
        SET lot_id = #{lotId},
            updated_by = 'system'
        WHERE plate_id = #{plateId}
    </update>

    <select id="queryVehicleList" resultType="com.wmt.smartparking.model.Vehicle" parameterType="com.wmt.smartparking.dto.VehicleDto">
        SELECT
        lot_id as lotId,
        plate_id as plateId,
        owner_name as ownerName,
        car_type as carType,
        created_by as createdBy,
        updated_by as updatedBy,
        created_at as createdAt,
        updated_at as updatedAt
        FROM vehicle
        <where>
            <if test="lotId != null">
                lot_id = #{lotId}
            </if>
            <if test="ownerName != null and ownerName != ''">
                owner_name = #{ownerName}
            </if>
            <if test="plateId != null and plateId != ''">
                plate_id = #{plateId}
            </if>
            <if test="carType != null">
                car_type = #{carType}
            </if>
        </where>
        ORDER BY lot_id desc
    </select>

    <select id="countVehiclePerLot" resultType="java.lang.Integer" parameterType="java.lang.Long">
        SELECT count(1)
        FROM vehicle
        WHERE lot_id = #{lotId}
    </select>

    <select id="countVehicleByPlate" resultType="com.wmt.smartparking.model.Vehicle" parameterType="java.lang.String">
        SELECT  lot_id as lotId,
                car_type as carType,
        FROM vehicle
        WHERE plate_id = #{plateId}
    </select>

    <select id="getLotIdByVehicle" resultType="java.lang.Long" parameterType="com.wmt.smartparking.dto.VehicleDto">
        SELECT lot_id
        FROM vehicle
        WHERE plate_id = #{plateId}
          AND lot_id != 0
    </select>

</mapper>